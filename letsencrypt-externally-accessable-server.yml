---
  # This playbook will only work for publicly accessable servers!

  # See https://certbot.eff.org/lets-encrypt/ubuntutrusty-nginx for the configuration docs
  # all the necessary steps are executed in this script here
  - name: Update apt
    apt:
      update_cache: yes

  - name: Install software-properties-common
    apt:
      name: software-properties-common
      state: latest

  - name: Add PPA for certbot
    apt_repository:
      repo: ppa:certbot/certbot

  - name: Update apt
    apt:
      update_cache: yes

  - name: Install python-certbot-nginx
    apt:
      name: python-certbot-nginx
      state: latest

  # See https://certbot.eff.org/docs/using.html#certbot-command-line-options for more details on how to use certbot cli
  - name: Use LetsEncrypt certbot to gain certificates
    shell: "certbot --nginx --non-interactive -d {{gitlab_domain}} --email {{letsencrypt_mailadress}} --agree-tos"
    become: true
